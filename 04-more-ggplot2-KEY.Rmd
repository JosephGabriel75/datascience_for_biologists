---
title: "More practice with `ggplot2`"
subtitle: "Data Science for Biologists, Spring 2020"
author: "KEY"
date: "`r Sys.Date()`"
output: 
  html_document:
    highlight: tango
css: static/sjs-style.css

---

<!-- SETUP CODE CHUNK -->
```{r setup, include=FALSE}
## Change the default figure width and height to your liking, but within reason.
knitr::opts_chunk$set(echo = TRUE, fig.width=4, fig.height=3)
library(tidyverse)
library(patchwork)
theme_set(theme_classic())
sparrows <- read_csv("data/sparrows.csv")
```


## <mark>Questions</mark>

##### Question 1 
Visualize the distribution of `Survival` using a bar plot, where all bars are filled with a single color of your choosing.

```{r survival-barplot}
ggplot(sparrows, aes(x = Survival)) + geom_bar(fill = "purple")
```
    
    
##### Question 2

You may have noticed in Question #1, `Alive` was automatically plotted before `Dead`. What if we wanted `Dead` before `Alive` on the X-axis? **We'd have to re-factor the column!**. For this question, do the following:

+ Use your new factor skills to convert _both_ `Survival` and `Age` to factors. For `Survival`, set the order to be be (1) Dead, (2) Alive. for `Age`, the order should be (1) Young, (2) Adult. 
  + In total, this should be _two_ lines of code only (one line for each variable) - in a single line, you should set the variable as a factor AND define its levels.
  +Confirm you are correct by printing the LEVELS of each column
+ Then, make a new barplot visualizing `Survival` with your re-factored variable to see how the X-axis order changed. 


```{r factor-survival-age}
sparrows$Survival <- factor(sparrows$Survival, levels=c("Dead", "Alive"))
sparrows$Age <- factor(sparrows$Age, levels=c("Young", "Adult"))

ggplot(sparrows, aes(x = Survival)) + geom_bar(fill="purple")
```
    

##### Question 3
Visualize the distribution of `Survival` using a bar plot, where bars are also colored (filled) by `Age`, to make a _grouped bar plot_. There are two ways these bars can be represented: stacked (this will happen by DEFAULT when you add the fill) or dodged (add the argument `position = "dodge"` to `geom_bar()`). 

Make one of each type of barplot, and in the space below, answer whether males or females where more likely to survive. Write an additional 1-2 sentences describing which visualization choice makes it easier to answer this question.
  
  + When making these plots, you should SAVE your `ggplot` object to a variable and then PRINT the variable in the R chunk, e.g.:
    ```{r, example-variable-plot, eval=FALSE}
    p1 <- ggplot(sparrows, aes(...)) + geom_whatever()
    print(p1)
    ```


  

```{r survival-age-stacked}
## Fill in your code here for the STACKED barplot. 
p1 <- ggplot(sparrows, aes(x = Survival)) + geom_bar(aes(fill = Age))
print(p1)
```
  
```{r survival-age-dodged}
## Fill in your code here for the DODGED barplot.
p2 <- ggplot(sparrows, aes(x = Survival)) + geom_bar(aes(fill = Age), position = "dodge")
print(p2)
```
    
<answer>
<!-- your answer goes in here. DO NOT DELETE THE ANSWER TAGS -->


</answer>

##### Question 4
It is possible to add plots together with the _awesome_ package [`patchwork`](https://patchwork.data-imaginist.com/articles/patchwork.html), which has been installed and loaded for you. Below, add your two bar plots together with a `+` sign by adding the two variables - the code will be short! Then, stack your plots by dividing with with the `/` sign. *You will need to tweak the figure width/height to get a nice-looking output, beware.*


```{r survival-sex-patch1}
## Add the plots for side-by-side view
p1 + p2
```


```{r survival-sex-patch2}
## Divide the plots for a stacked view
p1/p2
```


##### Question 5
Compare the distributions of living vs. dead sparrow skull widths using a single _density plot_, where distributions are colored (filled) according to their `Survival` status. Make sure both distributions are fully visible and not blocking each other (hint! what other option do you need?), and specify _your own_ colors for this task using either colors of your choosing or an existing palette.
  
In the space below, write 1-2 sentences about whether skull width may have been a contributing factor to who lived and who died.


```{r survival-skull-density}
## Fill in your density plot code here
ggplot(sparrows, aes(x = Skull_Width, fill = Survival)) + 
  geom_density(alpha = 0.5) + 
  scale_fill_manual(values=c("yellow", "black"))
```


<answer>
<!-- your answer goes in here. DO NOT DELETE THE ANSWER TAGS -->
    
    
</answer>



##### Question 6
We will now learn to make a _faceted_ plot, which splits your figure into a row or grid of panels highlighting different subsets of the data. Our goal is to re-make the density plot from Question 5, but _faceting by sex_: This means there will be one plot for Males and one plot for Females (ordered by factor level!!). There are two functions that can accomplish this: `facet_wrap()` and `facet_grid()`; the latter is most useful for faceting multiple variables.

  + Consider this simple example of visualizing iris sepal lengths _faceted by Species_, using the function `facet_wrap()`:
    ```{r facet-demo}
    ggplot(iris, aes(x = Sepal.Length)) + 
      geom_density() +
      facet_wrap(~Species) ## the tilde!! so important!!
    ```
  

Now, convert your plot from Question 5 so that it is faceted by `Sex`. In the space below, write 2-4 sentences about whether considering sex separately when plotting helped you to understand trends in the data. What trends do you now see that you didn't see before, if any? What trends are new?
    

```{r survival-skull-density-facet}
### code for faceted plot goes here
ggplot(sparrows, aes(x = Skull_Width, fill = Survival)) + 
  geom_density(alpha = 0.5) + 
  scale_fill_manual(values=c("yellow", "black")) + 
  facet_wrap(~Sex)
```




##### Question 7
Make a jitter plot of `Weight` across `Sex`, colored by `Age`. *Before you plot, think carefully about what belongs on X vs Y axis.* For this task, you should choose your own colors, ensure the jitter width makes the plot readable, AND place the legend at the BOTTOM of the plot.

```{r weight-sex-age-jitter}
ggplot(sparrows, aes(x = Sex, y = Weight, color = Age)) + 
  geom_jitter(width = 0.1) + 
  scale_color_manual(values = c("orange", "darkgreen")) + 
  theme(legend.position = "bottom")
```

##### Question 8
Make a second jitter plot of `Weight` across `Sex`, except this time color all points according to the bird's `Length`. Again, choose your own colors, ensure an appropriate jitter width, place the legend at the bottom, and ensuring the color scheme is appropriate for the _type of variable you are mapping to color_ which is now a CONTINUOUS variable:

+ When specifying _discrete color scales_, we use `scale_color_manual()` (or its `_fill_` equivalent)
+ When specifying _continuous color scales_, we often use one of two functions:
  + `scale_color_gradient()` (or again its `_fill_` equivalent). There is also a function called `scale_color_continuous()`, which just takes you back to the gradient function anyways.
  + `scale_color_distiller()`, which provides you access to [`RColorBrewer`](https://www.datanovia.com/en/blog/the-a-z-of-rcolorbrewer-palette/) palettes. 
  
**Get started writing your answer by using the code `scale_color_distiller(palette = "Reds")` and customize to your liking from there.**

```{r weight-sex-length-jitter}
### code for jitter plot colored by length goes here
ggplot(sparrows, aes(x = Sex, y = Weight, color = Length)) + 
  geom_jitter(width = 0.1) + 
  scale_color_distiller(palette = "Reds") + 
  theme(legend.position = "bottom")
```


##### Question 9
Plot the distribution of sparrow sternum lengths as histograms faceted by `Sex` AND `Age` by using the function `facet_grid(x~y)`, where `x` and `y` are the two variables you are faceting across (be brave, jump in the deep end, and try it out!). Make sure that the `Sex` facet is shown VERTICALLY and the `Age` facet is shown `HORIZONTALLY`.

When styling your histograms:
  + Choose a bin width that makes all histograms mostly continuous (no empty spaces between bars).
  + Add histogram fills according to EITHER `Sex` or `Age`
  + Make the color of the histograms black
  
```{r sternum-facet-histogram}
### code for faceted histogram goes here
ggplot(sparrows, aes(x = Sternum_Length, fill = Age)) + 
  geom_histogram(binwidth = 0.6, color = "black") + 
  facet_grid(Sex~Age) 
```

##### Question 10
Visualize the relationship between sparrow skull length (X axis) and skull width (Y axis) using a scatterplot where points are colored by `Sex`. Choose your own colors yet again, and **save your plot to a variable** for future use. _For this plot, make sure to NOT include a title._

In the space below, describe the relationship in 2-3 sentences: is it positive or negative? strong or weak? Do you see any systematic differences between sexes, or are patterns most the same between sexes?

```{r skull-scatter}
ggplot(sparrows, aes(x = Skull_Length, y = Skull_Width)) + 
  geom_point(aes(color = Sex)) +
  scale_color_manual(values=c("green", "orange")) -> p
print(p)
```


<answer>
<!-- your answer goes in here. DO NOT DELETE THE ANSWER TAGS -->
    
    
</answer>


##### Question 11
In fact, we can continue to modify existing plots. Let's add a _title_ to the plot from Question 10, simply by adding the appropriate label to the variable you definitely saved.

```{r skull-scatter-title}
p + labs(title = "its mah title")
```

##### Question 12
We will now recreate the scatterplot to include a _line of best fit_ (also known as _regression line_) with the additional geom, `geom_smooth(method = "lm")` (don't worry about its specific `method="lm"` argument yet). We will want to color the points by `Sex`, as before. Perform this task below in TWO WAYS:

+ Place the aesthetic mapping to color within the `geom_point()` call
+ Place the aesthetic mapping to color within the overall `ggplot()` call (along with X and Y specs). 

In the space below, explain why the lines of best fit (aka regression lines) look different between the two plots, and what each line represents in each plot. In addition, based on your figures, do you think males and females have fundamentally different RELATIONSHIPS between skull width and length?

```{r skull-scatter-smooth-1}
## Scatterplot + line of best fit goes here, with color in geom_point
ggplot(sparrows, aes(x = Skull_Length, y = Skull_Width)) + 
  geom_point(aes(color=Sex)) + 
  geom_smooth(method = "lm")
```


```{r skull-scatter-smooth-2}
## Scatterplot + line of best fit goes here, with color in ggplot
ggplot(sparrows, aes(x = Skull_Length, y = Skull_Width, color = Sex)) + 
  geom_point() + 
  geom_smooth(method = "lm")
```
    
  
<answer>
<!-- your answer goes in here. DO NOT DELETE THE ANSWER TAGS -->
    
    
</answer>


##### Question 13
In the last question, we began to observe that it might matter where the aesthetic mapping is specified. To try and understand this further, consider the following code chunk which has a bug and gives an error.


```{r bug, error=TRUE}
## This code will not work - run it and see the error message!
ggplot(sparrows, aes(color = Sex)) + 
  geom_point(aes(x = Skull_Length, y = Skull_Width)) + 
  geom_smooth(method = "lm")
```

Considering this example, and what you observed in Question 12, what did you learn about how aesthetic placement is applied to geoms?

<answer>
<!-- your answer goes in here. DO NOT DELETE THE ANSWER TAGS -->
    
    
</answer>


##### Question 14
Finally let's learn one more useful geom: `geom_text()`. Yet again, re-create the same scatterplot but **replace `geom_point()` with `geom_text()`**. This will write some text label rather than drawing points, so we need to tell `ggplot` what the label is (look up the docs! you can do it!). 

> Note: neither of these plots is particularly good. But, they do teach how to use `geom_text()`!


Do this task in two ways: 

+ Make all labels the letter "B" for bird
+ Make all labels the `Age` of that bird (hint: This is an aesthetic mapping!).

```{r skull-scatter-text-B}
### Scatterplot with points all labeled "B" goes here
ggplot(sparrows, aes(x = Skull_Length, y = Skull_Width)) + 
  geom_text(label = "B")
```
    
    
    
```{r skull-scatter-text-Sex}
## Scatterplot with points labeled according to sex goes here
ggplot(sparrows, aes(x = Skull_Length, y = Skull_Width)) + 
  geom_text(aes(label = Age))
```
